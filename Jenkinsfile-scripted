node {
    try {
        stage('Checkout') {
            checkout scm
        }

        stage('Build') {
            def buildNum = env.BUILD_NUMBER.toInteger()
            echo "Build Number: ${buildNum}"

            if (buildNum > 5) {
                error("Build number greater than 5! Stopping pipeline.")
            }

            sh 'mvn clean package'
        }

        stage('Deploy') {
            if (env.BRANCH_NAME == 'main') {
                echo "ğŸš€ Deploying application..."
                sh 'echo "Deployed!"'  
            }
        }

        echo 'ğŸ‰ Build succeeded!'

    } catch (err) {
        echo 'âŒ Build failed!'
        throw err
    } finally {
        echo 'Pipeline finished.'
    }
}
